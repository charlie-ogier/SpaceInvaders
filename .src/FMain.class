' Gambas class file

bLRKey As Boolean
bLRMove As Boolean
byMove As Byte
hMissile As PictureBox
bPict As Boolean
siSound As Short

Public Sub Form_Open()

PanelMove.Width = 600
CreateInvaders
TimerMove.Start
TimerDoom.Start

End

Public Sub CreateInvaders()
Dim hPicBox As PictureBox
Dim siCount As Short
Dim siTag As Short = 1
Dim byDistance As Byte = 80

PanelPlayArea.Children.Clear

For siCount = 1 To 11
  hPicBox = New PictureBox(PanelPlayArea) 

  With hPicBox
    .Height = 48
    .Width = 48
    .x = 25 + (siCount * byDistance)
    .y = 100
    .Picture = Picture.Load("../saucer2a.png")
    .Tag = siTag
  End With
  Inc siTag
Next

For siCount = 1 To 11
  hPicBox = New PictureBox(PanelPlayArea) 

  With hPicBox
    .Height = 48
    .Width = 48
    .x = 25 + (siCount * byDistance)
    .y = 150
    .Picture = Picture.Load("../saucer3a.png")
    .Tag = siTag
  End With
  Inc siTag
Next

For siCount = 1 To 11
  hPicBox = New PictureBox(PanelPlayArea) 

  With hPicBox
    .Height = 48
    .Width = 48
    .x = 25 + (siCount * byDistance)
    .y = 200
    .Picture = Picture.Load("../saucer1a.png")
    .Tag = siTag
  End With
  Inc siTag
Next

End

Public Sub GoLeft()
Dim siWidth As Short = PanelMove.Width 

siWidth -= 10

If siWidth < 0 Then siWidth = 0
PanelMove.width = siWidth

End

Public Sub GoRight()
Dim siWidth As Short = PanelMove.Width

siWidth += 10

If siWidth > Fmain.Width - 52 Then siWidth = FMain.Width - 52
PanelMove.width = siWidth 

End

Public Sub TimerKeys_Timer()

If bLRKey Then 
  GoRight
Else
  GoLeft
End If

End

Public Sub Form_Resize()

Label1.text = "H: " & Str(Me.H) & " W: " & Str(Me.w) 

End

Public Sub Form_KeyPress()

If Key.code = Key.Right Then 
  bLRKey = True
  TimerKeys.start
Endif

If Key.code = Key.Left Then 
  bLRKey = False
  TimerKeys.start
Endif

End

Public Sub Form_KeyRelease()

If Key.code = Key.Right Or Key.Code = Key.Left Then TimerKeys.stop
If Key.code = Key.Space Then Fire

End

Public Sub Fire()
Dim siStart As Short = (PictureBoxGun.x + (PictureBoxGun.Width / 2)) - 3

If TimerGun.Enabled = True Then Return

TimerDoom.Stop
Music.Load("shoot.ogg")
Music.play
TimerDoom.Start

hMissile = New PictureBox(PanelPlayArea) As "Missile"
With hMissile
  .Height = 48
  .Width = 48
  .x = siStart
  .Y = PanelPlayArea.Height - 8
  .Picture = Picture.Load("../missile.png")
End With

TimerGun.Start

End

Public Sub TimerMove_Timer()
Dim oObj As Object
Dim siWay As Short = 10

If bLRMove Then 
  siWay = -10
End If

For Each oObj In PanelPlayArea.Children
  If IsNull(oObj.tag) Then Continue
  If oObj.tag > 0 Then oObj.x += siWay
  Wait 0.05
Next

Inc byMove
If byMove > 12 Then
  byMove = 0
  bLRMove = Not bLRMove
  For Each oObj In PanelPlayArea.Children
    If oObj.Tag Then oObj.y += 10
  Next
Endif

End

Public Sub ButtonStop_Click()

TimerKeys.Stop
TimerMove.Stop
Stop Event
Wait 1
Me.Close

End

Public Sub TimerGun_Timer()
Dim oObj As Object
Dim siX As Short = hMissile.X
Dim siY As Short = hMissile.Y
Dim siTemp1, siTemp2 As Short
Dim siXYTag As New Short[33, 3]                                            '1st Number is the number of Saucers
Dim siCount As Short
Dim bGameEnd As Boolean = True

hMissile.y -= 20
If hMissile.y < -10 Then 
  TimerGun.Stop
  hMissile.Delete
End If

For Each oObj In PanelPlayArea.Children
  If oObj.Tag Then
    siXYTag[siCount, 0] = oObj.X
    siXYTag[siCount, 1] = oObj.Y 
    siXYTag[siCount, 2] = oObj.Tag
    bGameEnd = False
  End If 
  Inc siCount
Next

If bGameEnd = True Then
  TimerDoom.Stop
  TimerMove.Stop
Endif

 For siCount = 0 To 32
  If siX > siXYTag[siCount, 0] + 2 And siX < siXYTag[siCount, 0] + 48 Then
    If siXYTag[siCount, 1] > siY And siY < siXYTag[siCount, 1] + 48 Then
     Try hMissile.Delete
     Hit(siXYTag[siCount, 2])
     TimerGun.stop
     Return
    End If 
  Endif
Next

End

Public Sub Hit(siTag As Short)
Dim oObj As Object
Dim siX, siY As Short
Dim hBang As PictureBox

For Each oObj In PanelPlayArea.Children
  If oObj.Tag Then
    If oObj.Tag = siTag Then
    siX = oObj.X
    siY = oObj.Y
    oObj.Delete 
      hBang = New PictureBox(PanelPlayArea)
      With hBang
        .X = siX
        .Y = siY
        .Picture = Picture.Load("../bang.png")
      End With
      Music.Load("invaderkilled.ogg")
      Music.Play
      TimerDoom.delay -= 5
      TimerMove.delay -= 5
      Wait 0.3 
      hBang.delete
    End If 
  Endif
Next

PanelPlayArea.Refresh

End

Public Sub TimerDoom_Timer()
Dim sSound As String[] = ["fastinvader1.ogg", "fastinvader2.ogg", "fastinvader3.ogg", "fastinvader4.ogg"]

If siSound > 3 Then siSound = 0

Music.Load(sSound[siSound])
Music.Play

Inc siSound 

End
